(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory);}else if(typeof module==="object"&&module.exports){module.exports=factory(require("jquery"));}else{factory(window.jQuery);}}(function($){$.fn.ddslick=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==="object"||!method){return methods.init.apply(this,arguments);}else{$.error("Method "+method+" does not exists.");}};var methods={};var settingsMap={};var defaults={data:[],keepJSONItemsOnTop:false,animationTime:50,height:null,background:"#eee",selectText:"",defaultSelectedIndex:null,truncateDescription:true,imagePosition:"left",showSelectedHTML:true,clickOffToClose:true,embedCSS:true,onSelected:function(){}};var closeListenerInitialized=false;var ddSelectHtml="<div class='dd-select'><input class='dd-selected-value' type='hidden' /><a class='dd-selected'></a><span class='dd-pointer dd-pointer-down'></span></div>";var ddOptionsHtml="<ul class='dd-options'></ul>";var ddslickCSS="<style id='css-ddslick' type='text/css'>"+
".dd-select{ border-radius:2px; border:solid 1px #ccc; position:relative; cursor:pointer;}"+
".dd-desc { color:#aaa;  overflow: hidden; font-weight:normal; line-height: 1.4em; }"+
".dd-selected{ overflow:hidden;  padding:10px; font-weight:bold;}"+
".dd-pointer{ width:0; height:0; position:absolute; right:10px; top:50%; margin-top:-3px;}"+
".dd-pointer-down{ border:solid 5px transparent; border-top:solid 5px #000; }"+
".dd-pointer-up{border:solid 5px transparent !important; border-bottom:solid 5px #000 !important; margin-top:-8px;}"+
".dd-options{ border:solid 1px #ccc; border-top:none; list-style:none; box-shadow:0px 1px 5px #ddd; display:none; position:absolute; z-index:2000; margin:0; padding:0;background:#fff; overflow:auto;}"+
".dd-option{ padding:10px; display:block; border-bottom:solid 1px #ddd; overflow:hidden; text-decoration:none; color:#333; cursor:pointer;-webkit-transition: all 0.25s ease-in-out; -moz-transition: all 0.25s ease-in-out;-o-transition: all 0.25s ease-in-out;-ms-transition: all 0.25s ease-in-out; }"+
".dd-options > li:last-child > .dd-option{ border-bottom:none;}"+
".dd-option:hover{ background:#f3f3f3; color:#000;}"+
".dd-selected-description-truncated { text-overflow: ellipsis; white-space:nowrap; }"+
".dd-option-selected { background:#f6f6f6; }"+
".dd-option-image, .dd-selected-image { vertical-align:middle; float:left; margin-right:5px; max-width:64px;}"+
".dd-image-right { float:right; margin-right:15px; margin-left:5px;}"+
".dd-container{ position:relative;}​ .dd-selected-text { font-weight:bold}​</style>";methods.init=function(userOptions){var options=$.extend({},defaults,userOptions);if($("#css-ddslick").length<=0&&options.embedCSS){$(ddslickCSS).appendTo("head");}
return this.each(function(){var options=$.extend({},defaults,userOptions);var obj=$(this),data=obj.data("ddslick");if(!data){var ddSelect=[];obj.find("option").each(function(){var $this=$(this),thisData=$this.data();ddSelect.push({text:$.trim($this.text()),value:$this.val(),selected:$this.is(":selected"),description:thisData.description,imageSrc:thisData.imagesrc});});if(options.keepJSONItemsOnTop)
$.merge(options.data,ddSelect);else options.data=$.merge(ddSelect,options.data);var original=obj,placeholder=$("<div>").attr("id",obj.attr("id"));obj.replaceWith(placeholder);obj=placeholder;var settingsId="ID_"+(new Date()).getTime();$(obj).attr("data-settings-id",settingsId);settingsMap[settingsId]={};$.extend(settingsMap[settingsId],options);obj.addClass("dd-container").append(ddSelectHtml).append(ddOptionsHtml);obj.find("input.dd-selected-value").attr("id",$(original).attr("id")).attr("name",$(original).attr("name"));var ddOptions=obj.find(".dd-options");ddSelect=obj.find(".dd-select");if(options.height!==null)
ddOptions.css({height:options.height,overflow:"auto"});$.each(options.data,function(index,item){if(item.selected)options.defaultSelectedIndex=index;var ddList=$("<li>").append($("<a>").addClass("dd-option"));var ddOption=ddList.find("a");if(item.value)ddOption.append($("<input>").addClass("dd-option-value").attr("type","hidden").val(item.value));if(item.imageSrc)ddOption.append($("<img height='25px' align='center'>").attr("src",item.imageSrc));ddOptions.append(ddList);});var pluginData={settings:options,original:original,selectedIndex:-1,selectedItem:null,selectedData:null};obj.data("ddslick",pluginData);if(options.selectText.length>0&&options.defaultSelectedIndex===null){obj.find(".dd-selected").html(options.selectText);}
else{var index=(options.defaultSelectedIndex!=null&&options.defaultSelectedIndex>=0&&options.defaultSelectedIndex<options.data.length)?options.defaultSelectedIndex:0;selectIndex(obj,index,false);}
obj.find(".dd-select").on("click.ddslick",function(){open(obj);});obj.find(".dd-option").on("click.ddslick",function(){selectIndex(obj,$(this).closest("li").index(),true);});if(options.clickOffToClose){ddOptions.addClass("dd-click-off-close");obj.on("click.ddslick",function(e){e.stopPropagation();});if(!closeListenerInitialized){closeListenerInitialized=true;$("body").on("click",function(){$(".dd-open").removeClass("dd-open");$(".dd-click-off-close").slideUp(options.animationTime).siblings(".dd-select").find(".dd-pointer").removeClass("dd-pointer-up");});}}}});};methods.select=function(options){return this.each(function(){if(options.index!==undefined)
selectIndex($(this),options.index);if(options.value!==undefined)
selectValue($(this),options.value);if(options.id!==undefined)
selectValue($(this),options.id);});};methods.open=function(){return this.each(function(){var $this=$(this),pluginData=$this.data("ddslick");if(pluginData)
open($this);});};methods.close=function(){return this.each(function(){var $this=$(this),pluginData=$this.data("ddslick");if(pluginData)
close($this);});};methods.destroy=function(){return this.each(function(){var $this=$(this),pluginData=$this.data("ddslick");if(pluginData){var originalElement=pluginData.original;$this.removeData("ddslick").unbind(".ddslick").replaceWith(originalElement);}});};function selectValue(obj,value){var index=obj.find(".dd-option-value[value= '"+value+"']").parents("li").prevAll().length;selectIndex(obj,index);}
function selectIndex(obj,index,callbackOnSelection){var pluginData=obj.data("ddslick");var ddSelected=obj.find(".dd-selected"),ddSelectedValue=ddSelected.siblings(".dd-selected-value"),selectedOption=obj.find(".dd-option").eq(index),selectedLiItem=selectedOption.closest("li"),settings=pluginData.settings,selectedData=pluginData.settings.data[index];obj.find(".dd-option").removeClass("dd-option-selected");selectedOption.addClass("dd-option-selected");pluginData.selectedIndex=index;pluginData.selectedItem=selectedLiItem;pluginData.selectedData=selectedData;if(settings.showSelectedHTML){var ddSelectedData=$("<div>");if(selectedData.imageSrc)ddSelectedData.append($("<img height='20px'>").attr("src",selectedData.imageSrc));ddSelected.html(ddSelectedData.html());}
else ddSelected.html(selectedData.text);ddSelectedValue.val(selectedData.value);pluginData.original.val(selectedData.value);obj.data("ddslick",pluginData);close(obj);adjustSelectedHeight(obj);if(callbackOnSelection&&typeof settings.onSelected=="function"){settings.onSelected.call(this,pluginData);}}
function open(obj){var $this=obj.find(".dd-select"),ddOptions=$this.siblings(".dd-options"),ddPointer=$this.find(".dd-pointer"),wasOpen=ddOptions.is(":visible"),settings=settingsMap[obj.attr("data-settings-id")];$(".dd-click-off-close").not(ddOptions).slideUp(settings.animationTime);$(".dd-pointer").removeClass("dd-pointer-up");$this.removeClass("dd-open");if(wasOpen){ddOptions.slideUp(settings.animationTime);ddPointer.removeClass("dd-pointer-up");$this.removeClass("dd-open");}
else{$this.addClass("dd-open");ddOptions.slideDown(settings.animationTime);ddPointer.addClass("dd-pointer-up");}
adjustOptionsHeight(obj);}
function close(obj){var settings=settingsMap[obj.attr("data-settings-id")];obj.find(".dd-select").removeClass("dd-open");obj.find(".dd-options").slideUp(settings.animationTime);obj.find(".dd-pointer").removeClass("dd-pointer-up").removeClass("dd-pointer-up");}
function adjustSelectedHeight(obj){var lSHeight=obj.find(".dd-select").css("height");var descriptionSelected=obj.find(".dd-selected-description");var imgSelected=obj.find(".dd-selected-image");if(descriptionSelected.length<=0&&imgSelected.length>0){obj.find(".dd-selected-text").css("lineHeight",lSHeight);}}
function adjustOptionsHeight(obj){obj.find(".dd-option").each(function(){var $this=$(this);var lOHeight=$this.css("height");var descriptionOption=$this.find(".dd-option-description");var imgOption=obj.find(".dd-option-image");if(descriptionOption.length<=0&&imgOption.length>0){$this.find(".dd-option-text").css("lineHeight",lOHeight);}});}}));